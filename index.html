<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <title>FinFlow</title>
  <link rel="stylesheet" href="app.css" />
  <link rel="stylesheet" href="styles/components/nav.css" />
  <link rel="manifest" href="./manifest.json" />
  <meta name="theme-color" content="#000000" />
  <link rel="apple-touch-icon" sizes="180x180" href="./images/apple-touch-icon.png" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="icon" type="image/png" sizes="192x192" href="./images/icon-192.png" />
  <link rel="icon" type="image/png" sizes="512x512" href="./images/icon-512.png" />
</head>

<body>
  <script type="module">
    import { UNDO_SVG, REDO_SVG, GEAR_SVG, FOLDER_SVG } from "./scripts/ui/components/icons.js";
    
    document.addEventListener('DOMContentLoaded', () => {
      const undoBtn = document.getElementById('undoBtn');
      const redoBtn = document.getElementById('redoBtn');
      const mainsettings = document.getElementById('mainsettings');
      const settingsBtn = document.getElementById('settingsBtn');
      
      if (undoBtn) undoBtn.innerHTML = UNDO_SVG;
      if (redoBtn) redoBtn.innerHTML = REDO_SVG;
      if (redoBtn) redoBtn.innerHTML = REDO_SVG;
      if (mainsettings) mainsettings.innerHTML = GEAR_SVG;
      if (settingsBtn) settingsBtn.innerHTML = FOLDER_SVG;
    });
  </script>

  <div id="welcomeOverlay" class="ff-esc-disabled ff-popup-overlay ff-welcome-overlay ff-overlay-center hidden">
    <div class="ff-welcome-panel">
      <div class="welcome-logo">
        <img src="./images/logo.png" alt="FinFlow Logo" class="welcome-logo-img" />
      </div>
      <p class="ff-welcome-tagline" data-i18n="wizard.welcome.tagline"></p>
      <button id="welcomeStartBtn" class="ff-btn ff-btn--primary" data-i18n="wizard.welcome.button"></button>
    </div>
  </div>

  <!--
    Sticky top-area: header + nav-pill must stay in place while
    the year overview + month cards can be vertically swiped.
  -->
  <div id="ffTopArea" class="ff-top-area">

  <header style="position: relative; padding: calc(env(safe-area-inset-top, 0px) + 10px) 16px 10px 16px;">
    <h1 data-i18n="common.app_title" style="margin: 0; padding-right: 45px;"></h1>
    <button id="mainsettings" class="icon-btn" type="button" style="position: absolute; right: 16px; top: calc(env(safe-area-inset-top, 0px) + 10px); background: none; border: none; cursor: pointer;"></button>
  </header>

  <div id="devPanel" class="dev-panel" style="display:none;">
    <button id="devExportBtn" data-i18n="common.export_data"></button>
    <button id="devImportBtn" data-i18n="common.import_data"></button>
    <input type="file" id="importFileInput" accept="application/json" style="display:none;">
  </div>

  <div id="yearNavPill" class="nav-pill">
    <div id="navZoneLeft" class="nav-zone">
        <button id="prevYearBtn" class="year-arrow">◀</button>
    </div>

    <div id="navZoneCenter" class="nav-zone">
        <span id="currentYear">2025</span>
        <button id="undoBtn" class="icon-btn nav-icon-btn" type="button" disabled aria-disabled="true"></button>
        <button id="redoBtn" class="icon-btn nav-icon-btn" type="button" disabled aria-disabled="true"></button>
        <button id="scenariosBtn" class="icon-btn nav-icon-btn" type="button"></button>
        <button id="settingsBtn" class="icon-btn" type="button"></button>
    </div>

    <div id="navZoneRight" class="nav-zone">
        <button id="nextYearBtn" class="year-arrow">▶</button>
    </div>
  </div>

  </div>

  <!-- Scroll container: ONLY this area should scroll on vertical swipe -->
  <main id="ffScrollArea" class="ff-scroll-area">

  <div class="table-container ff-year-cards-container">
    <table class="year-grid ff-year-cards-table"> 
      <thead>
        <tr>
          <th data-i18n="table.headers.month"></th>
          <th data-i18n="table.headers.income"></th>
          <th data-i18n="table.headers.expense"></th>
          <th class="saving-cell" data-i18n="table.headers.savings"></th>
          <th data-i18n="table.headers.bank_balance"></th> 
          <th data-i18n="table.headers.savings_balance"></th> 
        </tr>
      </thead>
      <tbody id="yearTableBody"></tbody>
      <tfoot>
        <tr id="yearTotalRow"></tr> 
      </tfoot>
    </table>
  </div>

  </main>

  <div id="setupOverlay" class="ff-popup-overlay ff-popup-overlay--wizard" style="display:none;">
    <div id="setupSheet" class="ff-popup ff-popup--wizard ff-popup--beginsaldo">
      <div class="ff-popup__header">
        <h2 id="setupTitle" class="ff-popup__title" data-i18n="wizard.steps.balance_title"></h2>
      </div>
      <div class="ff-popup__body">
        <label class="ff-field ff-field--full">
          <span class="ff-field__label" data-i18n="common.bank_account"></span>
          <input id="setupBankInput" type="number" inputmode="decimal" step="0.01" min="0" class="ff-input ff-input--number ff-input--beginsaldo" />
        </label>
        <p class="ff-popup__hint" data-i18n="wizard.steps.balance_desc"></p>
      </div>
      <div class="ff-popup__footer">
        <button type="button" id="setupCancelBtn" class="ff-btn ff-btn--secondary" data-i18n="common.cancel"></button>
        <button type="button" id="setupSaveBtn" class="ff-btn ff-btn--primary" data-i18n="common.save"></button>
      </div>
    </div>
  </div>

  <div id="sheetOverlay" class="ff-popup-overlay" style="display: none;">
    <div id="sheetForm"></div>
  </div>

  <!-- FF_DIAG_BOOT 20260217-224726 -->
<script>
  (function(){
    const BUILD = "20260217-224726";
    function ensureOverlay(){
      let o = document.getElementById("ffBootDiag");
      if (o) return o;
      o = document.createElement("div");
      o.id = "ffBootDiag";
      o.style.cssText = "position:fixed;inset:0;z-index:999999;background:rgba(0,0,0,.92);color:#fff;font:12px/1.4 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial,sans-serif;padding:14px;display:none;overflow:auto;-webkit-overflow-scrolling:touch;";
      o.innerHTML = '<div style="font-weight:700;font-size:14px;margin-bottom:8px;">FinFlow boot diagnostics</div>'
        + '<div id="ffBootDiagMeta" style="opacity:.85;margin-bottom:10px;"></div>'
        + '<pre id="ffBootDiagBody" style="white-space:pre-wrap;word-break:break-word;margin:0;"></pre>'
        + '<div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;">'
        + '<button id="ffBootDiagCopy" style="padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.08);color:#fff;">Copy</button>'
        + '<button id="ffBootDiagHide" style="padding:10px 12px;border-radius:10px;border:1px solid rgba(255,255,255,.2);background:rgba(255,255,255,.08);color:#fff;">Hide</button>'
        + '</div>';
      document.body.appendChild(o);
      o.querySelector("#ffBootDiagHide").onclick = () => o.style.display = "none";
      o.querySelector("#ffBootDiagCopy").onclick = async () => {
        const txt = o.querySelector("#ffBootDiagBody").textContent || "";
        try { await navigator.clipboard.writeText(txt); } catch (e) {}
      };
      return o;
    }
    function show(obj){
      const o = ensureOverlay();
      o.style.display = "block";
      const meta = o.querySelector("#ffBootDiagMeta");
      const body = o.querySelector("#ffBootDiagBody");
      meta.textContent = `BUILD $20260217-224726 | ` + location.href;
      body.textContent = JSON.stringify(obj, null, 2);
    }
    window.__ffShowBootDiag = show;
    // Minimal banner so we know this index is live
    document.addEventListener("DOMContentLoaded", () => {
      const b = document.createElement("div");
      b.id = "ffBootDiagBanner";
      b.style.cssText = "position:fixed;left:12px;right:12px;top:12px;z-index:999998;padding:8px 10px;border-radius:12px;background:rgba(255,0,140,.18);border:1px solid rgba(255,0,140,.35);color:#fff;font:12px -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Arial,sans-serif;backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);";
      b.textContent = "FF_DIAG_BOOT " + BUILD + " (tap for details)";
      b.onclick = () => show({ title: "banner tapped", build: BUILD, href: location.href, ua: navigator.userAgent });
      document.body.appendChild(b);
    });
  })();
</script>

<script type="module">
  const BUILD = "20260217-224726";
  const src = "./scripts/main.js";
  async function diag(){
    // 1) fetch status + headers
    let fetchInfo = null;
    try {
      const r = await fetch(src + "?v=" + Date.now(), { cache: "no-store" });
      const ct = r.headers.get("content-type");
      const cc = r.headers.get("cache-control");
      const txt = await r.text();
      fetchInfo = {
        status: r.status,
        ok: r.ok,
        contentType: ct,
        cacheControl: cc,
        head: txt.slice(0, 120)
      };
    } catch (e) {
      fetchInfo = { fetchError: String(e && (e.message||e)) };
    }

    // 2) dynamic import to get a real error message on iOS
    try {
      await import(src + "?v=" + Date.now());
    } catch (e) {
      const info = {
        title: "main.js import failed",
        build: BUILD,
        href: location.href,
        ua: navigator.userAgent,
        fetch: fetchInfo,
        error: {
          name: e && e.name,
          message: e && e.message,
          stack: e && e.stack
        }
      };
      if (window.__ffShowBootDiag) window.__ffShowBootDiag(info);
      else alert(JSON.stringify(info, null, 2));
      return;
    }

    // If import succeeds, we can hide banner quickly
    const banner = document.getElementById("ffBootDiagBanner");
    if (banner) banner.style.display = "none";
  }
  diag();
</script>

  <script>
    document.getElementById("mainsettings").onclick = () => {
      const p = document.getElementById("devPanel");
      p.style.display = (p.style.display === "none" || p.style.display === "") ? "block" : "none";
    };
  </script>
</body>
</html>